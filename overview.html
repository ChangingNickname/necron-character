<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Файл: За'аргул, Лич-Страж</title>
  <style>
    /* БАЗОВЫЙ СТИЛЬ СТРАНИЦЫ */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #00ff66;
      font-family: Consolas, "Roboto Mono", monospace;
    }

    .wrapper {
      min-height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }

    .terminal {
      max-width: 900px;
      width: 100%;
      border: 1px solid #00aa44;
      padding: 20px 24px;
      box-sizing: border-box;
      background: radial-gradient(circle at top, #002200 0, #000 60%);
      box-shadow: 0 0 20px #00aa44;
      overflow: hidden;
    }

    .terminal-header {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 8px;
    }

    /* ОБЛАСТЬ ВИДОВ (ЭКРАНОВ) */
    .views {
      position: relative;
      height: 260px;
      overflow: hidden;
      transition: height 0.6s ease;
    }

    .views.expanded {
      height: 500px;
    }

    .views-inner {
      position: relative;
      width: 100%;
      min-height: 260px;
      transform: translateY(0);
      transition: transform 0.6s ease;
    }

    .view {
      box-sizing: border-box;
      width: 100%;
      min-height: 260px;
      padding-top: 4px;
    }

    #view-biometrics,
    #view-protocols,
    #view-dossier {              /* <<< НОВОЕ: добавили dossier */
      padding-top: 255px;
    }

    #view-biometrics .buttons-row,
    #view-protocols .buttons-row,
    #view-dossier .buttons-row { /* <<< НОВОЕ: общий стиль */
      margin-top: 0;
      margin-bottom: 20px;
    }

    /* ОБЩИЙ БЛОК ТЕКСТА — БЕЗ СКРОЛЛА */
    .terminal-body {
      white-space: pre-wrap;
      font-size: 16px;
      line-height: 1.4;
      min-height: 190px;
      overflow-y: hidden;        /* <<< ВАЖНО: тут скролл убираем */
    }

    /* СКРОЛЛ ТОЛЬКО ДЛЯ ЛИЧНОГО ДЕЛА */
    #dossier-body {               /* <<< НОВОЕ */
      max-height: 400px;          /* ограничиваем высоту */
      overflow-y: auto;           /* внутренний скролл только здесь */
    }

    .cursor {
      display: inline-block;
      width: 9px;
      height: 18px;
      background-color: #00ff66;
      margin-left: 2px;
      animation: blink 0.8s steps(1) infinite;
      vertical-align: bottom;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    /* КНОПКИ-РАЗДЕЛЫ */
    .buttons-row {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .nav-btn {
      position: relative;
      padding: 10px 16px;
      border-radius: 4px;
      border: 1px solid #00aa44;
      background: rgba(0, 20, 0, 0.9);
      color: #00ff99;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      cursor: pointer;
      text-decoration: none;
      filter: drop-shadow(0 0 6px #004422);
      overflow: hidden;

      /* ВАЖНО: изначально скрыты */
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .nav-btn::before {
      content: "";
      position: absolute;
      left: -40%;
      top: 0;
      width: 40%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(0, 255, 153, 0.35), transparent);
      transform: skewX(-20deg);
      opacity: 0;
    }

    .nav-btn:hover {
      box-shadow: 0 0 10px #00ff99;
      background: rgba(0, 40, 0, 0.95);
    }

    .nav-btn:hover::before {
      animation: shine 0.7s forwards;
      opacity: 1;
    }

    @keyframes shine {
      from { transform: translateX(-120%) skewX(-20deg); }
      to   { transform: translateX(200%) skewX(-20deg); }
    }

    .nav-btn.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Чуть приглушённая кнопка "Назад" */
    .nav-btn.back {
      border-color: #008844;
      color: #66ffcc;
      text-transform: none;
      letter-spacing: 0.03em;

      /* главное: она не скрыта */
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width: 600px) {
      .terminal {
        padding: 16px 14px;
      }

      .views {
        position: relative;
        height: 340px;
        overflow: hidden;
      }

      .view {
        box-sizing: border-box;
        width: 100%;
        min-height: 260px;
        padding-top: 0;
        display: flex;              /* делаем колонку */
        flex-direction: column;
      }

      .terminal-body {
        white-space: pre-wrap;
        font-size: 16px;
        line-height: 1.4;
        flex: 1;                    /* занимает всё свободное место */
        overflow-y: hidden;         /* по умолчанию без скролла */
      }

      #dossier-body {           /* но для личного дела включаем */
        overflow-y: auto;
      }

      .buttons-row {
        flex-direction: column;
      }
      .nav-btn {
        width: 100%;
        text-align: center;
      }
    }

    /* Спец-оформление протоколов */
    .protocol-red {
      color: #ff3333;
    }

    .protocol-strike {
      text-decoration: line-through;
      opacity: 0.85;
    }

  </style>
</head>
<body>
  <div class="wrapper">
    <div class="terminal">
      <div class="terminal-header">
        <div>NECRONTYR / DATA-NEXUS</div>
        <div>УРОВЕНЬ ДОПУСКА: &Omega;-VERITAS</div>
      </div>

      <div class="views">
        <div class="views-inner" id="views-inner">
          <!-- ====== ЭКРАН ОБЗОРА ====== -->
          <section class="view" id="view-overview">
            <div id="overview-body" class="terminal-body"></div>

            <div class="buttons-row">
              <button class="nav-btn" data-target="biometrics">
                Биометрическая Идентификация
              </button>
              <button class="nav-btn" data-target="protocols">
                Протоколы
              </button>
              <button class="nav-btn" data-target="dossier">
                Личное Дело
              </button>
            </div>
          </section>

          <!-- ====== ЭКРАН БИОМЕТРИИ ====== -->
          <section class="view" id="view-biometrics">
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="biometrics-body" class="terminal-body"></div>
          </section>

          <!-- ====== ЭКРАН ПРОТОКОЛОВ ====== -->
          <section class="view" id="view-protocols">
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="protocols-body" class="terminal-body"></div>
          </section>

          <!-- ====== ЭКРАН ЛИЧНОГО ДЕЛА ====== -->
          <section class="view" id="view-dossier">   <!-- <<< НОВОЕ -->
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="dossier-body" class="terminal-body"></div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- ТЕКСТ ОБЗОРА ---------- */
    const overviewLines = [
      ">> ИНИЦИАЛИЗАЦИЯ ДОСТУПА К АРХИВУ...",
      ">> ПОИСК ФАЙЛА: ЗА'АРГУЛ...",
      ">> СТАТУС: АКТИВЕН   |   РЕГАЛИЯ: СВИТА РЕГЕНТА",
      ">> ДИНАСТИЯ: [ДАННЫЕ ЗАШИФРОВАНЫ]   |   МИР-ГРОБНИЦА: [ДАННЫЕ ЗАШИФРОВАНЫ]",
      ">> ФУНКЦИЯ: ПЕРВЫЙ МЕЧ, ЛИЧ-СТРАЖА, ИСПОЛНИТЕЛЬ ПРИГОВОРОВ",
      ">> ПРЕДВАРИТЕЛЬНЫЙ ОБЗОР ФАЙЛА ЗАГРУЖЕН."
    ];

    /* ---------- ТЕКСТ БИОМЕТРИИ / АВТОРИЗАЦИИ ---------- */
    const biometricsLines = [
      ">> ДОСТУП К ПОДРАЗДЕЛУ: БИОМЕТРИЧЕСКАЯ ИДЕНТИФИКАЦИЯ...",
      ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
      ">> ЗАГРУЗКА ТЕЛЕСНЫХ ПАРАМЕТРОВ ЛИЧ-СТРАЖА...",
      "",
      "   ИДЕНТИФИКАТОР: ЗА'АРГУЛ",
      "   ТЕЛЕСНАЯ ФОРМА: НЕКРОДЕРМИС, ФАЗОВО УСТОЙЧИВАЯ",
      "      ЛОКАЛЬНЫЕ ПОВРЕЖДЕНИЯ: УСТРАНЕНЫ АВТО-РЕФОРМАЦИЕЙ",
      "      СОСТОЯНИЕ НЕКРОДЕРМИСА: ОПТИМАЛЬНОЕ [ПОВЕРХНОСТНЫЕ СЛОИ ОКИСЛЕНЫ]",
      "      ПСИХО-ФИЗИЧЕСКОЕ СОСТОЯНИЕ: НЕСТАБИЛЬНОЕ[!]",
      "   РАНГ ВОИНА: ЛИЧ-СТРАЖ РЕГЕНТА",
      "   СТАТУС РЕАКТИВАЦИИ: НЕПРЕРЫВНЫЙ БОЕВОЙ РЕЖИМ",
      "   ВЫСОТА: 2.75 МЕТРА",
      "   ВЕС: 680 КИЛОГРАММ",
      "   ВОЗРАСТ: 60,049,147 лет",
      "   В ПОДЧИНЕНИИ: РЕГЕНТУ ТИРАНХУ",
      "",
      ">> КОНЕЦ БИОМЕТРИЧЕСКОЙ ИДЕНТИФИКАЦИИ."
    ];

    /* ---------- ТЕКСТ ПРОТОКОЛОВ ---------- */
    // const protocolsLines = [
    //   ">> ДОСТУП К ПОДРАЗДЕЛУ: ПРОТОКОЛЫ...",
    //   ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
    //   ">> ЗАГРУЗКА ПРОТОКОЛОВ ЛИЧ-СТРАЖА...",
    //   "",
    //   "   ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА.",
    //   "",
    //   "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ ДЕФЕКТНЫХ НЕКРОН-ЕДИНИЦ.",
    //   "",
    //   ">> СПИСОК ПРОТОКОЛОВ ГОТОВ К ПРОСМОТРУ."
    // ];

    /* ---------- ТЕКСТ ЛИЧНОГО ДЕЛА ---------- */
    const dossierLines = [
      ">> ДОСТУП К ПОДРАЗДЕЛУ: ЛИЧНОЕ ДЕЛО...",
      ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
      ">> ЗАГРУЗКА ЛИЧНОГО ДЕЛА ЛИЧ-СТРАЖА ЗА'АРГУЛА...",
      "",
      "   ДОСЬЕ: ЗА'АРГУЛ",
      "   РОЛЬ: СВИТА РЕГЕНТА TYRANTH, ЛИЧ-СТРАЖ, ПЕРВЫЙ МЕЧ.",
      "",
      "   КРАТКАЯ ИСТОРИЯ:",
      "     > До биотрансфера: личный прозорец Регента, предсказавший страдания",
      "       расы после сделки с К'тан.",
      "     > Насильственно отправлен на биотрансфер по требованию старших Домов.",
      "     > Пробудился с сохранённой эмоциональной матрицей и патологической",
      "       ненавистью к сородичам.",
      "",
      "   ПСИХО-ПРОФИЛЬ:",
      "     > Абсолютная преданность голосу Регента.",
      "     > Стойкая агрессия к любой некрон-единице вне прямого приказа.",
      "     > Зафиксированы многомиллионолетние периоды одиночного несна.",
      "",
      "   ОСОБЫЕ ОТМЕТКИ:",
      "     > Допущен к постоянной охране саркофагов Регента и Первой Касы.",
      "     > Проявляет аномальную терпимость к Каноптек-конструкциям.",
      "     > В бою проявляет сверхнормативную эффективность против собственных",
      "       боевых единиц, если они помечены как 'отклонение'.",
      "",
      ">> ЛИЧНОЕ ДЕЛО: ЗАГРУЗКА ЗАВЕРШЕНА.",
      ">> ПРОКРУТИТЕ ДЛЯ ПРОСМОТРА ПОЛНОГО ЗАПИСАННОГО БЛОКА."
    ];

    // const typingSpeed = 15;
    // const linePause = 200;

    const typingSpeed = 1;
    const linePause = 2;

    /* ---------- ОБЗОР: АНИМАЦИЯ ПЕЧАТИ ---------- */
    const overviewBody = document.getElementById("overview-body");
    const overviewCursor = document.createElement("span");
    overviewCursor.className = "cursor";
    overviewBody.appendChild(overviewCursor);

    let ovLineIndex = 0;
    let ovCharIndex = 0;
    let ovCurrentText = "";

    function typeOverview() {
      const line = overviewLines[ovLineIndex];

      if (ovCharIndex < line.length) {
        ovCurrentText += line[ovCharIndex];
        renderOverview();
        ovCharIndex++;
        setTimeout(typeOverview, typingSpeed);
      } else {
        ovCurrentText += "\n";
        renderOverview();
        ovLineIndex++;
        ovCharIndex = 0;

        if (ovLineIndex < overviewLines.length) {
          setTimeout(typeOverview, linePause);
        } else {
          showOverviewButtons();
        }
      }
    }

    function renderOverview() {
      overviewBody.innerHTML = "";
      overviewBody.appendChild(document.createTextNode(ovCurrentText));
      overviewBody.appendChild(overviewCursor);
    }

    function showOverviewButtons() {
      const buttons = document.querySelectorAll("#view-overview .nav-btn");
      buttons.forEach((btn, i) => {
        setTimeout(() => {
          btn.classList.add("show");
        }, 200 * i);
      });
    }

    /* ---------- БИОМЕТРИЯ ---------- */
    const biometricsBody = document.getElementById("biometrics-body");
    const biometricsCursor = document.createElement("span");
    biometricsCursor.className = "cursor";

    let bioLineIndex = 0;
    let bioCharIndex = 0;
    let bioCurrentText = "";
    let biometricsStarted = false;

    function startBiometricsTyping() {
      if (biometricsStarted) return;
      biometricsStarted = true;

      biometricsBody.innerHTML = "";
      bioLineIndex = 0;
      bioCharIndex = 0;
      bioCurrentText = "";
      biometricsBody.appendChild(biometricsCursor);
      typeBiometrics();
    }

    function typeBiometrics() {
      const line = biometricsLines[bioLineIndex];

      if (bioCharIndex < line.length) {
        bioCurrentText += line[bioCharIndex];
        renderBiometrics();
        bioCharIndex++;
        setTimeout(typeBiometrics, typingSpeed);
      } else {
        bioCurrentText += "\n";
        renderBiometrics();
        bioLineIndex++;
        bioCharIndex = 0;

        if (bioLineIndex < biometricsLines.length) {
          setTimeout(typeBiometrics, linePause);
        }
      }
    }

    function renderBiometrics() {
      biometricsBody.innerHTML = "";
      biometricsBody.appendChild(document.createTextNode(bioCurrentText));
      biometricsBody.appendChild(biometricsCursor);
    }

        // Случайные приказы Регента
    const necronOrders = [
      "Стереть любое органическое присутствие в секторе VII.",
      "Изъять все ксенотех-артефакты для последующей переработки.",
      "Перенастроить геноцидные лучи на частоту Омега-13.",
      "Разоружить подразделения, показавшие признаки инициативы.",
      "Провести полную санацию мира-улея от споров тиранид.",
      "Погасить все звёзды подматрицы Тау-Сигма.",
      "Захватить пленных аэльдар для экспериментальной диссекции.",
      "Деактивировать неисправные некрон-воины путем дематериализации.",
      "Сместить текущего Повелителя сектора за проявленную слабость.",
      "Перенаправить энергию pylons в резерв Регента.",
      "Обрушить орбитальные обелиски на координаты вражеского штаба.",
      "Уничтожить все хранилища флеш-памяти органиков.",
      "Осквернить святыни Империума с помощью фазовых разломов.",
      "Переписать матрицы подчинения у всех Лич-Стражей.",
      "Захватить живыми высокопсиоников для вскрытия их разума.",
      "Стереть из хроник любые упоминания о поражениях Династии.",
      "Запечатать все варп-аномалии под контролем Династии.",
      "Изолировать заражённые некрон-единицы в тессерактовых лабиринтах.",
      "Подчинить местные техно-артефакты единому протоколу Кронуса.",
      "Воссоздать флот уничтоженных серпов Солнцеедов.",
      "Сместить орбиту планеты для оптимизации траекторий огня.",
      "Погрузить мир-улей в вечную ночь.",
      "Провести тотальную фазовую чистку нижних уровней креста.",
      "Принести Регенту голову местного «святого» в криостазе.",
      "Развернуть каноптек-рои для полной рекогносцировки сектора.",
      "Изъять у вассальных миров право на автономные решения.",
      "Запретить любое использование варп-двигателей в подконтрольной зоне.",
      "Переупаковать души павших в энергоячейки.",
      "Испепелить все синтетические религиозные объекты органиков.",
      "Стереть культурное наследие планеты в ноль.",
      "Дестабилизировать ядро мира с последующим контролируемым расколом.",
      "Уничтожить флот вторжения до выхода из варпа.",
      "Заклеймить все чуждые ИИ меткой подлежащих утилизации.",
      "Переназначить приоритеты: сначала регент, затем миры-склепы.",
      "Зарезервировать энергию звезды для локального подпития Регента.",
      "Провести испытание нового протокола обнуления личности.",
      "Стереть память у всех свидетелей прошлых поражений.",
      "Изъять автономию у подчинённых Оверлордов.",
      "Провести операцию по молниеносному обезглавливанию Имперского командования.",
      "Перенаправить некрон-фаланги на защиту саркофага Регента.",
      "Проверить лояльность Лич-Стражей посредством боевого испытания.",
      "Фазово внедрить обелиск в столичный дворец врага.",
      "Запретить использование неутверждённых протоколов каноптеков.",
      "Расширить тессерактовую тюрьму для особых образцов ксеносов.",
      "Перезаписать кодировки всех маяков пробуждения.",
      "Прекратить любые инициативы без прямой санкции Регента.",
      "Подчинить все локальные миры-склепы единому сигналу.",
      "Активировать резервные легионы спящих фаланг.",
      "Давить мораль врага через показательные казни органиков.",
      "Завершить дематериализацию поражённых фронтов без эвакуации.",
      "Перенести тронный зал Регента в более безопасный сектор.",
      "Уничтожить все каналы связи противника.",
      "Сломать оборону врага прямым орбитальным бомбардиpованием.",
      "Подчинить местных машинных духов через фазовый резонанс.",
      "Уничтожить все библиотеки знаний органиков.",
      "Собрать останки павших некронов для последующей рекалькуляции.",
      "Ликвидировать любых псайкеров в зоне боевых действий.",
      "Стереть генетические архивы планеты до нулевого уровня.",
      "Перевести все фронтовые протоколы в режим тотальной экстерминации.",
      "Поднять новый монолит на месте главного храма врага.",
      "Обрушить квантовый шторм на флот противника.",
      "Собрать данные о слабостях всех встреченных рас.",
      "Запретить сдачу в плен некрон-единиц.",
      "Пресечь любые попытки переговоров со стороны врага.",
      "Сканировать умы лидеров противника перед их уничтожением.",
      "Отрубить логистику врага через разрушение портов и шлюзов.",
      "Очиcтить орбиты от любых чужих станций.",
      "Навсегда запечатать варп-врата на планете.",
      "Перенастроить гробницы на ускоренное производство воинов.",
      "Восстановить утраченные артефакты временного контроля.",
      "Наградить наиболее эффективные фаланги дополнительной энергией.",
      "Уничтожить местные культы, мешающие страху врага.",
      "Развернуть сеть скрытых фазовых мин.",
      "Задействовать протокол самоликвидации поражённых миров.",
      "Сместить цепь командования в пользу наиболее безжалостных Оверлордов.",
      "Провести демонстративное разрушение луны противника.",
      "Вырезать командный состав врага в первую очередь.",
      "Восстановить древние схемы боевых построений.",
      "Перехватить и исказить все сигналы помощи врага.",
      "Прекратить любое использование живой пехоты союзников.",
      "Переквалифицировать мир-ферму в мир-склеп.",
      "Изъять ресурсы у слабых вассалов в пользу фронта.",
      "Провести массовую перековку некродермиса.",
      "Продлить цикл бодрствования ключевых Лич-Стражей.",
      "Захватить мир как трофей, а не уничтожать.",
      "Применить экспериментальные гравитационные орудия.",
      "Стереть координаты этого сектора из всех карт.",
      "Проверить лояльность каноптек-скарифов выборочным отключением.",
      "Объявить все остальные Династии временно низшим приоритетом.",
      "Уничтожить любые проявления индивидуальности в войсках.",
      "Погасить надежду врага на выживание через показательный геноцид города.",
      "Перезаписать древние клятвы на новое имя Регента.",
      "Выровнять численность фаланг до идеальной симметрии.",
      "Отправить сигналы ложного пробуждения в соседние миры-склепы.",
      "Обрушить электромагнитный шторм на технику врага.",
      "Собрать пантеон трофеев из позолоченных черепов командиров.",
      "Отключить протокол отступления на всех фронтах.",
      "Перепрограммировать тессерактовые лабиринты под пытки сознаний.",
      "Стереть понятие «милосердие» из всех боевых матриц.",
      "Превратить ключевой мир врага в планетарный саркофаг.",
      "Подготовить тронный мир к визиту К'тан-осколка.",
      "Установить маяк вечного владычества Регента над этим сектором."
    ];

    function getRandomOrder() {
      return necronOrders[Math.floor(Math.random() * necronOrders.length)];
    }

/* ---------- ПРОТОКОЛЫ: АНИМАЦИЯ ---------- */
    const protocolsBody = document.getElementById("protocols-body");

    let protocolsStarted = false;
    let protocolsTimers = [];

    // вспомогательная функция, чтобы потом всё остановить
    function clearProtocolsTimers() {
      protocolsTimers.forEach(id => clearTimeout(id));
      protocolsTimers = [];
    }

    // удобно планировать шаги анимации
    function scheduleProtocols(fn, delay) {
      const id = setTimeout(fn, delay);
      protocolsTimers.push(id);
    }

    // основной цикл анимации
    function runProtocolsAnimation() {
      if (!protocolsStarted) return;

      // чистим содержимое
      protocolsBody.innerHTML = "";

      // шапка протоколов — статичная
      const headerHtml = [
        ">> ДОСТУП К ПОДРАЗДЕЛУ: ПРОТОКОЛЫ...",
        ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
        ">> ЗАГРУЗКА ПРОТОКОЛОВ ЛИЧ-СТРАЖА ЗА'АРГУЛА...",
        ""
      ].join("<br>");

      protocolsBody.innerHTML = headerHtml + "<br>";

      // контейнер для изменяющихся строк
      const dyn = document.createElement("div");
      protocolsBody.appendChild(dyn);

      let t = 0;

      const currentOrder = getRandomOrder().toUpperCase();;  // приказ, который будет виден весь цикл


      // 1) исходный протокол
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 200));

      // 2) тот же, но красный + доп. текст
      scheduleProtocols(() => {
        dyn.innerHTML =
          `<span class="protocol-red">   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ. ПЕРЕЗАПИСЬ ПРИОРИТЕТА.</span>`;
      }, (t += 1200));

      // 3) зачёркнутый красный
      scheduleProtocols(() => {
        dyn.innerHTML =
          `<span class="protocol-red protocol-strike">   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ. ПЕРЕЗАПИСЬ ПРИОРИТЕТА.</span>`;
      }, (t += 1200));

      // 4) новый набор протоколов (зелёный) + приказ Регента
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА.<br>" +
          `      ПРИКАЗ РЕГЕНТА: ${currentOrder}<br><br>` +
          "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 1200));


      // 5) пауза, затем пометка "ВЫПОЛНЕНО"
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА. ВЫПОЛНЕНО.<br>" +
          `      ПРИКАЗ РЕГЕНТА: ${currentOrder}<br><br>` +
          "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 2000));


      // 6) зачёркиваем первый протокол целиком
      scheduleProtocols(() => {
        dyn.innerHTML =
          `   <span class="protocol-strike">ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА. ВЫПОЛНЕНО.</span><br>` +
          `   <span class="protocol-strike">   ПРИКАЗ РЕГЕНТА: ${currentOrder}</span><br><br>` +
          "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 1500));



      // 7) итог — остаётся только один протокол
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 1500));

      // 8) перезапускаем цикл
      scheduleProtocols(() => {
        if (protocolsStarted) {
          runProtocolsAnimation();
        }
      }, (t += 2000));
    }

    // функция запуска при открытии раздела
    function startProtocolsTyping() {
      if (protocolsStarted) return;
      protocolsStarted = true;
      clearProtocolsTimers();
      runProtocolsAnimation();
    }


    function typeProtocols() {
      const line = protocolsLines[protLineIndex];

      if (protCharIndex < line.length) {
        protCurrentText += line[protCharIndex];
        renderProtocols();
        protCharIndex++;
        setTimeout(typeProtocols, typingSpeed);
      } else {
        protCurrentText += "\n";
        renderProtocols();
        protLineIndex++;
        protCharIndex = 0;

        if (protLineIndex < protocolsLines.length) {
          setTimeout(typeProtocols, linePause);
        }
      }
    }

    function renderProtocols() {
      protocolsBody.innerHTML = "";
      protocolsBody.appendChild(document.createTextNode(protCurrentText));
      protocolsBody.appendChild(protocolsCursor);
    }

    /* ---------- ЛИЧНОЕ ДЕЛО ---------- */
    const dossierBody = document.getElementById("dossier-body");
    const dossierCursor = document.createElement("span");
    dossierCursor.className = "cursor";

    let dossierLineIndex = 0;
    let dossierCharIndex = 0;
    let dossierCurrentText = "";
    let dossierStarted = false;

    function startDossierTyping() {
      if (dossierStarted) return;
      dossierStarted = true;

      dossierBody.innerHTML = "";
      dossierLineIndex = 0;
      dossierCharIndex = 0;
      dossierCurrentText = "";
      dossierBody.appendChild(dossierCursor);
      typeDossier();
    }

    function typeDossier() {
      const line = dossierLines[dossierLineIndex];

      if (dossierCharIndex < line.length) {
        dossierCurrentText += line[dossierCharIndex];
        renderDossier();
        dossierCharIndex++;
        setTimeout(typeDossier, typingSpeed);
      } else {
        dossierCurrentText += "\n";
        renderDossier();
        dossierLineIndex++;
        dossierCharIndex = 0;

        if (dossierLineIndex < dossierLines.length) {
          setTimeout(typeDossier, linePause);
        }
      }
    }

    function renderDossier() {
      dossierBody.innerHTML = "";
      dossierBody.appendChild(document.createTextNode(dossierCurrentText));
      dossierBody.appendChild(dossierCursor);
    }

    /* ---------- ПЕРЕКЛЮЧЕНИЕ ЭКРАНОВ ---------- */
    const viewsInner = document.getElementById("views-inner");
    const viewsContainer = document.querySelector(".views");

    function goToView(target) {
      switch (target) {
        case "overview":
          viewsInner.style.transform = "translateY(0)";
          setTimeout(() => {
            viewsContainer.classList.remove("expanded");
          }, 600);

          clearProtocolsTimers();   // <--- вот эта строка


          // сбрасываем все экраны
          biometricsBody.innerHTML = "";
          protocolsBody.innerHTML = "";
          dossierBody.innerHTML = "";

          biometricsStarted = false;
          protocolsStarted = false;
          dossierStarted = false;

          bioLineIndex = bioCharIndex = 0;
          bioCurrentText = "";

          protLineIndex = protCharIndex = 0;
          protCurrentText = "";

          dossierLineIndex = dossierCharIndex = 0;
          dossierCurrentText = "";
          break;

        case "biometrics":
          viewsContainer.classList.add("expanded");
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-500px)";
          }, 50);
          setTimeout(startBiometricsTyping, 670);
          break;

        case "protocols":
          viewsContainer.classList.add("expanded");
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-1000px)";
          }, 50);
          setTimeout(startProtocolsTyping, 670);
          break;

        case "dossier":
          viewsContainer.classList.add("expanded");
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-1500px)";
          }, 50);
          setTimeout(startDossierTyping, 670);
          break;

        default:
          alert("Раздел \"" + target + "\" ещё не активирован.");
      }
    }

    /* ---------- ОБРАБОТЧИКИ КНОПОК ---------- */
    document.addEventListener("click", (e) => {
      const btn = e.target.closest(".nav-btn");
      if (!btn) return;

      const target = btn.getAttribute("data-target");
      if (!target) return;

      e.preventDefault();
      if (["biometrics", "overview", "protocols", "dossier"].includes(target)) {
        goToView(target);
      } else {
        goToView(target);
      }
    });

    /* ---------- ЗАПУСК ОБЗОРА ---------- */
    window.addEventListener("load", () => {
      typeOverview();
    });
  </script>
</body>
</html>
